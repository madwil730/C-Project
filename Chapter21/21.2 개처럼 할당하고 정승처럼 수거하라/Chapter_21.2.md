# 21.2 개처럼 할당하고 정승처럼 수거하라
* 할당된 메모리의 위치를 참조하는 개체를 일컬어 루트라고 한다, 루트는 스택 또는 힙에서 생성된다
* .Net 애플리케이션이 실행되면 JIT 컴파일러 루트들의 목록을 만들고 CLR은 루트 목록을 관리하며 상태를 갱신한다
* CLR이 관리하던 루트 목록을 참조해서 가비지 컬렉터 가 활동을 한다
  
### 메모리 할당 구조
1. CLR은 프로그램을 위한 일정 크기의 메모리를 확보해서 하나의 관리되는 힙을 만든다
2. CLR은 확보한 힙 메모리의 첫 번째 주소에 다음 객체를 할당할 메모리의 포인터를 위치시킨다
3. 다음 객체에 할당할 메모리의 포이터가 할당되면 포인터를 해당 객체가 차지하는 공간 바로 뒤에 이동한다

### 가비지 컬렉터 처리 방식
1. 작업을 시작하기 전에 가비지 컬렉터는 모든 객체가 쓰레기라고 가정한다, 즉 루트 목록 내의 어떤 루트도 메모리를 가리키지 않는다고 가정한다
2. 루트 목록을 순회하면서 각 루트가 참조하고 있는 힙 객체와의 관계 여부를 조사한다
3. 만약 루트가 참조하고 있는 힙의 객체가 또 다른 힙 객체를 참조하고 있다면 이 역시도 해당 루트와 관계가 있는것으로 판단한다
4. 쓰레기 객체가 차지하고 있던 메모리를 빈 공간으로 만든다
5. 루트 목록에 대한 조사가 끝나면, 가비지 컬렉터는 이제 힙을 순회하면서 쓰레기가 차지했던 비어 있는 공간에 쓰레기의 인접 객체들을 이동시켜 차곡차곡 채워 넣는다
6. 모든 객체의 이동이 끝나면 깨끗한 상태의 메모리를 얻게 된다
   

  

